<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>STAT HUB - 应用列表</title>
    <link href="stylesheets/stat.css" rel="stylesheet" type="text/css" />
    <script src="js/jquery-3.3.1.min.js" type="text/javascript"></script>
    <script src="js/common.js" type="text/javascript"></script>
    <script>
        $(document).ready(function () {
            var app = get_param('app').app;
            if (app) {
                app = app.replace('#', '');
                $.get('/v1/app/' + app + '/choreo', function(choreo, status, xhr) {
                    show_choreo(choreo);
                });
            }
            
            $('#save').click(function() {
                save_choreo();
            });
        });
        
        function save_choreo() {
            var app = $('#app').val();
            var query = $('#query').val();
            var scale = $('#scale').val();
            
            var choreo = {
                app: app,
                query: query,
                scale: scale
            };
            var json = JSON.stringify(choreo);
            
            $.post('/v1/app/' + app + '/_scale?num=' + scale, function(data, status, xhr) {
                if (data && data.ok) {
                    $.ajax({
                        url: '/v1/app/' + app + '/_query',
                        type: 'POST',
                        contentType: 'application/json',
                        data: query,
                        dataType: 'json',
                        success: function(data, status, xhr) {
                            alert('已经保存');
                            window.location.href = '/';
                        },
                        error: function(xhr, status, error) {
                            alert('保存失败，状态：' + error + ', 信息: ' + xhr.responseJSON.message);
                        }
                    });
                } else {
                    alert('保存失败, 信息: ' + data.message);
                }
            });
        }
        
        function show_choreo(choreo) {
            //status
            $('#app').attr("disabled","disabled")
            
            //display data
            $('#app').val(choreo.app);
            $('#query').val(choreo.query);
            $('#scale').val(choreo.scale);
        }
        
    </script>
</head>
<body>
<div id="wrapper">

    <div id="header">
        <a href="/"><img src="images/stat.png" alt="Status" /></a>
    </div>

    <div id="content">
        <div class="hidden" id="statusmessage">&nbsp;</div>
        <p>请使用下面的表单调整应用计划。</p>
        <form id="f" name="f" method="post">
            <div class="jive-contentBox">
                <table cellpadding="3" cellspacing="0" border="0">
                    <tbody>
                        <tr>
                            <td width="1%" nowrap></td>
                            <td width="49%" nowrap>
                                <div>应用名称: </div>
                                <div>
                                    <input type="text" name="app" size="80" maxlength="30" id="app"/>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td nowrap></td>
                            <td>
                                <div>节点: </div>
                                <div>
                                    <input type="text" name="query" size="80" maxlength="200" id="query"/>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td nowrap></td>
                            <td nowrap>
                                <div>计划进程数:</div>
                                <div>
                                    <input type="text" name="scale" size="80" maxlength="200" id="scale"/>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2" style="padding-top: 10px;">
                                <input type="button" name="save" id="save" value=" 保存 ">
                            </td>
                        </tr>
                        
                    </tbody>
                </table>
            </div>
        </form>
    </div>
    <br/>
    <div class="push">
    </div>
</div>

<div id="footer" class="clr">
    <div class="left">
        <a href="/">STAT HUB</a> <span id="supervisor_version">#</span>
    </div>
    <div class="right">
        &amp;copy; 2006-<span id="copyright_date">#</span> <strong>lane.cn@gmail.com</strong>
    </div>
</div>
</body>
</html>
