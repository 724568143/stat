<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" >
<mapper namespace="cn.batchfile.stat.server.dao.StackDao" >

	<resultMap id="stackResult" type="Stack">
		<result property="commandId" column="command_id"/>
		<result property="agentId" column="agent_id"/>
		<result property="pid" column="pid"/>
		<result property="beginTime" column="begin_time"/>
		<result property="status" column="status"/>
		<result property="name" column="name"/>
	</resultMap>
	
	<insert id="insertStack" parameterType="Stack">
		REPLACE INTO `stack` 
		(`command_id`,`agent_id`,`pid`,`begin_time`,`status`,`name`) 
		VALUES 
		(#{commandId},#{agentId},#{pid},#{beginTime},#{status},#{name})
	</insert>
	
	<select id="getRunningStacks" resultMap="stackResult">
		SELECT * FROM `stack` WHERE `status`='running'
	</select>

	<update id="updateStackStatus" parameterType="Stack">
		UPDATE `stack` SET `status`=#{status} WHERE `command_id`=#{commandId}
	</update>

	<insert id="insertStackData" parameterType="StackData">
		REPLACE INTO `stack_data` 
		(`command_id`,`time`,`agent_id`,`pid`,`count`,`stacks`)
		VALUES 
		(#{commandId},#{time},#{agentId},#{pid},#{count},#{stacks})
	</insert>

</mapper>